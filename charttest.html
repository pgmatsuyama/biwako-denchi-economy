<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>関西スポット価格グラフ</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #f0f8ff; }
    canvas { max-width: 100%; height: auto; }
    select { margin-bottom: 1em; padding: 0.3em; font-size: 1em; }
    .btn {
      display: inline-block;
      margin-top: 2em;
      padding: 1em 2em;
      background: #00796b;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
    }

  </style>
</head>
<body>
  <h1>関西スポット価格（30分刻み）</h1>
  <label for="dateSelect">日付を選択：</label>
  <select id="dateSelect"></select>
  <canvas id="priceChart"></canvas>

  <script>
    const csvData = `date,time,price_kansai
2025/04/01,0:00,11.00
2025/04/01,0:30,11.00
2025/04/01,1:00,10.87
2025/04/01,1:30,10.87
2025/04/01,2:00,11.27
2025/04/01,2:30,11.55
2025/04/01,3:00,11.71
2025/04/01,3:30,11.71
2025/04/01,4:00,11.71
2025/04/01,4:30,11.71
2025/04/01,5:00,11.71
2025/04/01,5:30,11.71
2025/04/01,6:00,11.71
2025/04/01,6:30,11.71
2025/04/01,7:00,11.71
2025/04/01,7:30,11.71
2025/04/01,8:00,11.71
2025/04/01,8:30,11.71
2025/04/01,9:00,11.71
2025/04/01,9:30,11.71
2025/04/01,10:00,11.71
2025/04/01,10:30,11.71
2025/04/01,11:00,11.71
2025/04/01,11:30,11.71
2025/04/01,12:00,11.71
2025/04/01,12:30,11.71
2025/04/01,13:00,11.71
2025/04/01,13:30,11.71
2025/04/01,14:00,11.71
2025/04/01,14:30,11.71
2025/04/01,15:00,11.71
2025/04/01,15:30,11.71
2025/04/01,16:00,11.71
2025/04/01,16:30,11.71
2025/04/01,17:00,11.71
2025/04/01,17:30,11.71
2025/04/01,18:00,11.71
2025/04/01,18:30,11.71
2025/04/01,19:00,11.71
2025/04/01,19:30,11.71
2025/04/01,20:00,11.71
2025/04/01,20:30,11.71
2025/04/01,21:00,11.71
2025/04/01,21:30,11.71
2025/04/01,22:00,11.71
2025/04/01,22:30,11.71
2025/04/01,23:00,11.71
2025/04/01,23:30,11.71`;

    const lines = csvData.trim().split("\n").slice(1);
    const dataByDate = {};
    for (const line of lines) {
      const [date, time, price] = line.split(',');
      if (!dataByDate[date]) dataByDate[date] = [];
      dataByDate[date].push({ time, price: parseFloat(price) });
    }

    const select = document.getElementById("dateSelect");
    Object.keys(dataByDate).forEach(date => {
      const option = document.createElement("option");
      option.value = date;
      option.textContent = date;
      select.appendChild(option);
    });

    const ctx = document.getElementById("priceChart").getContext("2d");
    let chart;

    function updateChart(date) {
      const dayData = dataByDate[date];
      const labels = dayData.map(d => d.time);
      const values = dayData.map(d => d.price);

      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: `${date} 関西スポット価格 (円/kWh)`,
            data: values,
            borderColor: 'blue',
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    select.addEventListener("change", e => updateChart(e.target.value));
    updateChart(select.value);
  </script>
        <a class="btn" href="index.html">戻る →</a>

</body>
</html>
